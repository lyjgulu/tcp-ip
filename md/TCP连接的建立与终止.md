## TCP连接的建立与终止
### 1、tcpdump输出三次握手四次挥手 
![tcpdump](https://raw.githubusercontent.com/lyjgulu/tcp-ip/main/image/tcpdump.png)
![tcpdumpinfo](https://raw.githubusercontent.com/lyjgulu/tcp-ip/main/image/tcpdumpinfo.png)

- 开始的序号，一个冒号，隐含的结尾序号，圆括号的数据字节数。
- 在第2行中，字段ack1415531522表示确认序号。它只有在首部中的ACK标志比特被设置1时才显示。
- win4096表示发端通告的窗口大小(默认大小)。
- 字段\<mss1024>表示由发端指明的最大报文段长度选项。
### 2、三次握手四次挥手 图18-3
#### 建立链接协议
- 三次握手
- 发送第一个SYN的一端将执行主动打开（active open）。接收这个SYN并发回下一个SYN的另一端执行被动打开（passive open）。
#### 建立链接协议
- 终止一个连接要经过4次握手。这由TCP的半关闭（halfclose）造成的。既然一个TCP连接是全双工（即数据在两个方向上能同时传递），因此每个方向必须单独地进行关闭。这原则就是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向连接。当一端收到一个FIN，它必须通知应用层另一端几经终止了那个方向的数据传送。发送FIN通常是应用层进行关闭的结果。
### 3、连接时超时 图18-6 
- 在这个输出中有趣的一点是客户间隔多长时间发送一个SYN，试图建立连接。第2个SYN与第1个的间隔是5.8秒(不准确)，而第3个与第2个的间隔是24秒。
### 4、最大报文段长度 
- 最大报文段长度（MSS）表示TCP传往另一端的最大块数据的长度。
- 当建立一个连接时，每一方都有用于通告它期望接收的MSS选项（MSS选项只能出现在SYN报文段中）。如果一方不接收来自另一方的MSS值，则MSS就定为默认值536字节。
### 5、复位报文段
- 一个报文段发往基准的连接（referenced connection）出现错误，TCP都会发出一个复位报文段。
#### 异常终止一个连接
- 有序释放（orderly release）是一方发送FIN，异常释放（abortive release）是发送一个复位报文段而不是FIN来中途释放一个连接。
- 异常终止一个连接对应用程序来说有两个优点：（1）丢弃任何待发数据并立即发送复位报文段；（2）RST的接收方会区分另一端执行的是异常关闭还是正常关闭。应用程序使用的API必须提供产生异常关闭而不是正常关闭的手段。
#### 检测半打开连接
- 半打开（Half-Open）:一方已经关闭或异常终止连接而另一方却还不知道
### 6、同时打开 图18-17
- 同时打开它仅建立一条连接，一个同时打开的连接需要交换4个报文段
### 7、同时关闭 图18-19
- 交换4个报文段
